<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MSTV Player</title>
    <!-- 1. Mux.js is REQUIRED for HLS playback in Shaka -->
    <script src="https://cdnjs.cloudflare.com"></script>
    <!-- 2. Your local Shaka Player library -->
    <script src="shaka.js"></script>
    
    <style>
        body, html { margin: 0; padding: 0; background: #000; height: 100%; overflow: hidden; }
        #video { width: 100%; height: 100%; background: #000; }
        #status-overlay { 
            position: absolute; top: 10px; left: 10px; color: #00ffA0; 
            font-family: sans-serif; font-size: 14px; z-index: 10;
        }
    </style>
</head>
<body>

    <div id="status-overlay">MSTV | Loading...</div>
    <video id="video" autoplay controls crossorigin="anonymous"></video>

    <script>
        const channels = {
            "1": {
                name: "Zee TV",
                url: "https://d1g8wgjurz8via.cloudfront.net",
                type: "shaka",
                drm: { 'ed068cf84f0640ccbc7c0e395c0a272e': 'bb722190f2bb446391020411a7d0828b' }
            },
            "2": {
                name: "Willow Cricket 2",
                url: "https://restream-live.realiptv.to",
                type: "hls"
            },
            "3": {
                name: "Deewana HD",
                url: "https://live20.bozztv.com",
                type: "shaka"
            },
            "4": {
                name: "Sky Sports",
                url: "https://nl1.rocketdns.info",
                type: "shaka"
            },
            "5": {
                name: "Star Gold",
                url: "https://anywhere.pwisetthon.com",
                type: "shaka"
            },
            "6": {
                name: "Zindgi Tv (Pak)",
                url: "https://5ad386ff92705.streamlock.net",
                type: "shaka"
            }
        };

        let player;

        async function initApp() {
            shaka.polyfill.installAll(); //
            if (!shaka.Player.isBrowserSupported()) {
                return alert("Browser not supported!");
            }

            const video = document.getElementById('video');
            player = new shaka.Player(video);

            // CONDITIONAL HEADERS: Only apply Zee5 headers to Zee5 links
            player.getNetworkingEngine().registerRequestFilter((type, request) => {
                if (request.uris.some(u => u.includes('cloudfront.net'))) {
                    request.headers['Origin'] = 'https://www.zee5.com';
                    request.headers['Referer'] = 'https://www.zee5.com';
                }
            });

            // Listen for errors
            player.addEventListener('error', (event) => console.error('Shaka Error:', event.detail));

            const query = window.location.search.substring(1);
            const chId = query || "1"; 
            loadChannel(chId);
        }

        async function loadChannel(id) {
            const ch = channels[id];
            const status = document.getElementById('status-overlay');

            if (!ch) {
                status.innerText = "Error: Channel " + id + " not found.";
                return;
            }

            status.innerText = "MSTV | " + ch.name;
            await player.unload(); //

            // Configure DRM if keys are present
            player.resetConfiguration();
            if (ch.drm) {
                player.configure({ drm: { clearKeys: ch.drm } });
            }

            try {
                await player.load(ch.url); //
            } catch (e) {
                status.innerText = "Playback Error: " + e.code;
                console.error("Load Error:", e);
            }
        }

        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
